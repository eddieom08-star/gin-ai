<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StayEasy - Voice Agent Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'se-dark': '#0f1117',
                        'se-darker': '#0a0c10',
                        'se-card': '#1a1d24',
                        'se-border': '#2a2d35',
                        'se-hover': '#252830',
                        'se-accent': '#10b981',
                        'se-success': '#22c55e',
                        'se-warning': '#f59e0b',
                        'se-error': '#ef4444',
                        'se-text': '#e5e7eb',
                        'se-muted': '#9ca3af',
                        'se-blue': '#3b82f6',
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1a1d24; }
        ::-webkit-scrollbar-thumb { background: #2a2d35; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #3a3d45; }
    </style>
</head>
<body class="bg-se-dark text-se-text">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // StayEasy Mock Data - Travel Booking Conversations
        const MOCK_CONVERSATIONS = [
            {
                id: "conv-001",
                date: "2026-01-20T15:00:00Z",
                duration: "2:49",
                messageCount: 17,
                channel: "voice",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Hello, welcome to StayEasy. I'm your booking assistant. How can I help you today?", timestamp: "00:00" },
                    { role: "customer", content: "Hi, I need to change the dates on my Barcelona hotel booking. Something came up at work.", timestamp: "00:06" },
                    { role: "agent", content: "I'd be happy to help you change your dates. Can you give me your booking confirmation number?", timestamp: "00:14" },
                    { role: "customer", content: "It's BK-8847291. The Grand Marina Hotel.", timestamp: "00:22" },
                    { role: "agent", content: "I found your booking at Grand Marina Hotel & Spa in Barcelona, currently scheduled for March 15th to 18th. What dates would you like to change to?", timestamp: "00:30" },
                    { role: "customer", content: "I need to push it back a week. So March 22nd to 25th if possible.", timestamp: "00:42" },
                    { role: "agent", content: "Let me check availability for those dates... Great news! The Deluxe Sea View room is available March 22nd to 25th. The rate is actually €15 per night less than your original booking.", timestamp: "00:52" },
                    { role: "customer", content: "Oh nice! So it'll be cheaper?", timestamp: "01:10" },
                    { role: "agent", content: "Yes, your new total would be €612 instead of €657. That's a savings of €45. Would you like me to make this change?", timestamp: "01:16" },
                    { role: "customer", content: "Yes, please do that.", timestamp: "01:30" },
                    { role: "agent", content: "I've updated your reservation. Your new dates are March 22nd to 25th, 2025 at Grand Marina Hotel & Spa. You'll receive an updated confirmation email shortly. Is there anything else I can help with?", timestamp: "01:38" },
                    { role: "customer", content: "Actually, can I also request early check-in? My flight lands at 9am.", timestamp: "01:55" },
                    { role: "agent", content: "I've added an early check-in request to your booking. Standard check-in is 3pm, but I've noted your 9am arrival. The hotel will do their best to accommodate you and will confirm closer to your arrival date.", timestamp: "02:05" },
                    { role: "customer", content: "Perfect, thank you so much!", timestamp: "02:25" },
                    { role: "agent", content: "You're welcome! Have a wonderful trip to Barcelona. Is there anything else?", timestamp: "02:30" },
                    { role: "customer", content: "No, that's all. Thanks!", timestamp: "02:40" }
                ],
                proseSummary: "Customer requested date change for Grand Marina Hotel booking BK-8847291 in Barcelona. Original dates March 15-18 changed to March 22-25. New dates resulted in €45 savings (€657 to €612). Customer also requested early check-in due to 9am flight arrival. Both requests completed successfully.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "neutral", end: "satisfied" },
                    topics: ["date_change", "booking_modification", "early_checkin", "special_request"],
                    actionItems: [],
                    followUpRequired: false,
                    keyEntities: { "booking_id": "BK-8847291", "property": "Grand Marina Hotel & Spa", "location": "Barcelona, Spain", "original_dates": "March 15-18, 2025", "new_dates": "March 22-25, 2025", "price_change": "-€45", "new_total": "€612", "special_request": "Early check-in (9am arrival)" },
                    summary: "Date change completed with €45 savings. Early check-in request added for 9am flight arrival."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Both customer requests (date change and early check-in) were fully completed. Customer confirmed satisfaction." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent was helpful and proactive, highlighting the cost savings without being prompted. Wished customer a wonderful trip." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent confirmed all booking details (property, dates, room type) before making changes. Verified new total and sent confirmation email." }
                ]
            },
            {
                id: "conv-002",
                date: "2026-01-20T14:30:00Z",
                duration: "4:12",
                messageCount: 23,
                channel: "voice",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Hi, thank you for calling StayEasy. How can I assist you?", timestamp: "00:00" },
                    { role: "customer", content: "I need to cancel my Paris booking but I'm worried about the cancellation fee. I booked a non-refundable rate.", timestamp: "00:08" },
                    { role: "agent", content: "I understand. Let me look into your booking. What's your confirmation number?", timestamp: "00:18" },
                    { role: "customer", content: "BK-9923847. It's the Ritz Carlton for April.", timestamp: "00:26" },
                    { role: "agent", content: "I found your booking at The Ritz Carlton Paris, April 10th to 14th. I see this was booked at our non-refundable rate. Can you tell me the reason for cancellation?", timestamp: "00:38" },
                    { role: "customer", content: "My father was just diagnosed with cancer. We need to be with family right now, not traveling.", timestamp: "00:52" },
                    { role: "agent", content: "I'm so sorry to hear about your father. That must be incredibly difficult for your family. Let me see what options we have for you given these circumstances.", timestamp: "01:05" },
                    { role: "customer", content: "I really can't afford to lose €2,400. That's a lot of money right now.", timestamp: "01:22" },
                    { role: "agent", content: "I completely understand. For medical emergencies, we do have a compassionate cancellation policy. With documentation from your father's doctor, we can offer you a full refund or credit for future travel. Which would you prefer?", timestamp: "01:35" },
                    { role: "customer", content: "Oh my god, really? A full refund would be amazing. What documentation do you need?", timestamp: "02:00" },
                    { role: "agent", content: "We'll need a letter from the treating physician confirming the diagnosis and that travel is not advisable for family members. You can upload this through your StayEasy account or email it to compassionate@stayeasy.com.", timestamp: "02:12" },
                    { role: "customer", content: "I can get that. How long does the refund take?", timestamp: "02:35" },
                    { role: "agent", content: "Once we receive the documentation, refunds are processed within 5-7 business days. I'm putting your booking on hold now so it won't auto-charge. You have 14 days to submit the documentation.", timestamp: "02:45" },
                    { role: "customer", content: "Thank you so much. I was dreading this call.", timestamp: "03:10" },
                    { role: "agent", content: "Please don't mention it. I hope your father's treatment goes well. We'll be here when you're ready to travel again. Is there anything else I can help with?", timestamp: "03:20" },
                    { role: "customer", content: "No, you've been wonderful. Thank you.", timestamp: "03:45" }
                ],
                proseSummary: "Customer requested cancellation of non-refundable Ritz Carlton Paris booking (BK-9923847, €2,400) due to father's cancer diagnosis. Agent applied compassionate cancellation policy offering full refund pending medical documentation. Booking placed on hold, 14-day window for documentation submission. Refund to process within 5-7 business days after receipt.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "frustrated", end: "satisfied" },
                    topics: ["cancellation", "refund_request", "compassionate_policy", "medical_emergency"],
                    actionItems: ["Customer to submit medical documentation within 14 days", "Process refund upon documentation receipt"],
                    followUpRequired: true,
                    keyEntities: { "booking_id": "BK-9923847", "property": "The Ritz Carlton Paris", "location": "Paris, France", "dates": "April 10-14, 2025", "refund_amount": "€2,400", "policy_applied": "Compassionate cancellation", "documentation_deadline": "14 days", "documentation_email": "compassionate@stayeasy.com" },
                    summary: "Non-refundable booking eligible for full refund under compassionate policy. Awaiting medical documentation."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Customer's concern about losing €2,400 was addressed with compassionate policy solution. Clear next steps provided." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent expressed genuine sympathy, acknowledged difficulty of situation, and wished father well. Customer explicitly noted agent was 'wonderful'." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent correctly identified booking as non-refundable, applied appropriate exception policy, and clearly communicated process and timelines." },
                    { criteriaId: "crit-005", criteriaName: "Policy Application", passed: true, reasoning: "Agent correctly applied compassionate cancellation policy for medical emergency. Placed booking on hold to prevent charges." }
                ]
            },
            {
                id: "conv-003",
                date: "2026-01-20T13:15:00Z",
                duration: "1:34",
                messageCount: 8,
                channel: "chat",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Hi! I'm your StayEasy booking assistant. How can I help?", timestamp: "00:00" },
                    { role: "customer", content: "Need to add my wife to my Dubai booking. Forgot to include her when I booked.", timestamp: "00:12" },
                    { role: "agent", content: "No problem! I can add a guest to your booking. What's your confirmation number?", timestamp: "00:20" },
                    { role: "customer", content: "BK-7756123 - Burj Al Arab", timestamp: "00:32" },
                    { role: "agent", content: "Found it! Burj Al Arab, May 20-25, currently showing 1 adult in a Deluxe Suite. I'll update this to 2 adults. What's your wife's full name as it appears on her passport?", timestamp: "00:42" },
                    { role: "customer", content: "Sarah Elizabeth Thompson", timestamp: "00:58" },
                    { role: "agent", content: "I've added Sarah Elizabeth Thompson to your booking. The suite accommodates 2 adults so there's no additional charge. Your updated confirmation has been sent to your email. Anything else?", timestamp: "01:08" },
                    { role: "customer", content: "That's it, thanks!", timestamp: "01:25" }
                ],
                proseSummary: "Customer requested to add spouse (Sarah Elizabeth Thompson) to Burj Al Arab Dubai booking BK-7756123 for May 20-25. Guest added to existing Deluxe Suite with no additional charge. Updated confirmation sent.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "neutral", end: "satisfied" },
                    topics: ["add_guest", "booking_modification"],
                    actionItems: [],
                    followUpRequired: false,
                    keyEntities: { "booking_id": "BK-7756123", "property": "Burj Al Arab", "location": "Dubai, UAE", "dates": "May 20-25, 2025", "room_type": "Deluxe Suite", "guest_added": "Sarah Elizabeth Thompson", "additional_charge": "None" },
                    summary: "Added spouse to Dubai booking. No additional charge for suite occupancy."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Guest added successfully, confirmation sent. Simple request handled efficiently." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent was helpful and proactive in explaining no additional charge would apply." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent verified booking details and collected guest's full passport name correctly." }
                ]
            },
            {
                id: "conv-004",
                date: "2026-01-20T11:45:00Z",
                duration: "3:28",
                messageCount: 15,
                channel: "voice",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Hello, thank you for calling StayEasy. How may I help you?", timestamp: "00:00" },
                    { role: "customer", content: "I'm at the hotel right now and they're saying they don't have my reservation! This is a nightmare!", timestamp: "00:08" },
                    { role: "agent", content: "Oh no, I'm so sorry you're experiencing this. Let me help sort this out immediately. What's your booking confirmation number?", timestamp: "00:18" },
                    { role: "customer", content: "BK-5543298. I have the confirmation email right here. Amsterdam Marriott, checking in today!", timestamp: "00:28" },
                    { role: "agent", content: "I can see your booking BK-5543298 for the Amsterdam Marriott, January 20th to 23rd. It shows as confirmed on our end. Let me contact the hotel directly to resolve this.", timestamp: "00:42" },
                    { role: "customer", content: "I've been standing at this desk for 30 minutes. My kids are exhausted from the flight.", timestamp: "01:00" },
                    { role: "agent", content: "I completely understand how stressful this is, especially with children. I'm calling the hotel's reservation manager now. Can you please hold for just a moment?", timestamp: "01:12" },
                    { role: "customer", content: "Fine, but please hurry.", timestamp: "01:28" },
                    { role: "agent", content: "Thank you for holding. I spoke with the hotel manager. There was a system sync error on their end - your booking didn't transfer to their local system. They've found your reservation now and are preparing your room.", timestamp: "02:15" },
                    { role: "customer", content: "So I can check in now?", timestamp: "02:30" },
                    { role: "agent", content: "Yes, please go back to the front desk and ask for the duty manager, Pieter. He's expecting you and will check you in personally. They're also upgrading you to a premium room for the inconvenience.", timestamp: "02:42" },
                    { role: "customer", content: "Okay... thank you for fixing this. I was really panicking.", timestamp: "03:00" },
                    { role: "agent", content: "You're very welcome. I'm also adding a €50 StayEasy credit to your account for the trouble. I'm so sorry this happened. Please reach out if you have any other issues during your stay.", timestamp: "03:10" }
                ],
                proseSummary: "Customer arrived at Amsterdam Marriott to find reservation missing from hotel system despite valid StayEasy confirmation BK-5543298. Agent contacted hotel directly, identified system sync error. Hotel found reservation, customer directed to duty manager Pieter for personal check-in. Room upgrade provided plus €50 StayEasy credit for inconvenience.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "frustrated", end: "satisfied" },
                    topics: ["missing_reservation", "hotel_issue", "system_error", "compensation"],
                    actionItems: ["Monitor for similar sync issues with Amsterdam Marriott", "Follow up on customer stay experience"],
                    followUpRequired: true,
                    keyEntities: { "booking_id": "BK-5543298", "property": "Amsterdam Marriott", "location": "Amsterdam, Netherlands", "dates": "January 20-23, 2026", "issue": "System sync error - reservation not in hotel system", "resolution": "Manual check-in with duty manager", "compensation": "Room upgrade + €50 credit", "hotel_contact": "Pieter (Duty Manager)" },
                    summary: "Missing reservation resolved via direct hotel contact. Customer received room upgrade and €50 credit."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Critical issue resolved in real-time. Customer was able to check in with upgraded room." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent acknowledged stress, especially with children involved. Acted with urgency and provided compensation without being asked." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent verified booking existed in StayEasy system before escalating to hotel. Correctly identified root cause." },
                    { criteriaId: "crit-006", criteriaName: "Escalation Handling", passed: true, reasoning: "Agent appropriately escalated by contacting hotel directly. Provided specific instructions for customer (duty manager name)." }
                ]
            },
            {
                id: "conv-005",
                date: "2026-01-20T10:20:00Z",
                duration: "0:52",
                messageCount: 4,
                channel: "chat",
                status: "failed",
                transcript: [
                    { role: "agent", content: "Hello! How can I help you today?", timestamp: "00:00" },
                    { role: "customer", content: "I want to cancel everything", timestamp: "00:12" },
                    { role: "agent", content: "I can help you with cancellation. Could you please provide your booking confirmation number so I can look up your reservation?", timestamp: "00:20" },
                    { role: "customer", content: "...", timestamp: "00:45" }
                ],
                proseSummary: "Customer requested to cancel 'everything' but abandoned conversation before providing booking details. No action taken. Customer may have multiple bookings requiring cancellation.",
                structuredSummary: {
                    outcome: "abandoned",
                    sentiment: { start: "frustrated", end: "frustrated" },
                    topics: ["cancellation"],
                    actionItems: ["Send follow-up email asking if cancellation help still needed", "Check if customer has multiple active bookings"],
                    followUpRequired: true,
                    keyEntities: { "request_type": "Full cancellation (details unknown)" },
                    summary: "Customer abandoned chat before providing booking details for cancellation request."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: false, reasoning: "Customer's cancellation request was not fulfilled. Conversation abandoned before booking details obtained." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: false, reasoning: "Agent response was functional but lacked warmth. 'I want to cancel everything' suggested distress that wasn't acknowledged." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent correctly requested booking confirmation before proceeding. N/A for accuracy as no booking was accessed." }
                ]
            },
            {
                id: "conv-006",
                date: "2026-01-19T16:30:00Z",
                duration: "5:45",
                messageCount: 28,
                channel: "voice",
                status: "failed",
                transcript: [
                    { role: "agent", content: "Thank you for calling StayEasy. How can I help?", timestamp: "00:00" },
                    { role: "customer", content: "I've been charged twice for my Tokyo hotel! Two charges of $3,200 on my credit card!", timestamp: "00:10" },
                    { role: "agent", content: "I'm so sorry to hear about the duplicate charge. That should not have happened. Let me look into this right away. What's your booking reference?", timestamp: "00:20" },
                    { role: "customer", content: "BK-4421987. Park Hyatt Tokyo. I only have one booking but you've taken $6,400 from my account!", timestamp: "00:32" },
                    { role: "agent", content: "I can see your booking for Park Hyatt Tokyo, March 1st to 5th. Let me check the payment records... I do see two charges processed on January 15th. This appears to be a system error.", timestamp: "00:50" },
                    { role: "customer", content: "A system error?! That's $3,200 of MY money! I need it back now, I have bills to pay!", timestamp: "01:10" },
                    { role: "agent", content: "I completely understand. This is unacceptable and I want to get this resolved immediately. Unfortunately, I don't have direct access to process refunds. I need to transfer you to our payments team who can initiate the refund right away.", timestamp: "01:25" },
                    { role: "customer", content: "Are you kidding me? I've been on hold for 45 minutes already to reach you!", timestamp: "01:45" },
                    { role: "agent", content: "I know, and I'm truly sorry for the wait and for this entire situation. What I can do is create a priority case and have the payments team call you back within 1 hour, rather than you waiting on hold again. Would that work?", timestamp: "02:00" },
                    { role: "customer", content: "I guess that's better than more hold time. But I want this fixed TODAY.", timestamp: "02:25" },
                    { role: "agent", content: "Absolutely. I'm creating an urgent case right now. I'm documenting that this is a duplicate charge of $3,200 that needs immediate refund. The payments team will call you within 60 minutes. Can I confirm your callback number?", timestamp: "02:38" },
                    { role: "customer", content: "+1-555-234-8976", timestamp: "03:00" },
                    { role: "agent", content: "Got it. I've also flagged this as a high-priority financial impact case. You should receive a call from our payments manager, and they have full authority to process the refund. Is there anything else I can note on the case?", timestamp: "03:12" },
                    { role: "customer", content: "Just make sure they actually call. This has been a disaster.", timestamp: "03:35" },
                    { role: "agent", content: "I've set a personal reminder to follow up if you haven't been contacted within the hour. I'm so sorry again for this experience.", timestamp: "03:45" }
                ],
                proseSummary: "Customer reported duplicate charge of $3,200 for Park Hyatt Tokyo booking BK-4421987 (total erroneous charge: $6,400). Agent confirmed system error but lacked refund processing authority. Created priority case for payments team callback within 1 hour. Customer callback number: +1-555-234-8976. Agent set personal follow-up reminder.",
                structuredSummary: {
                    outcome: "handed_over",
                    sentiment: { start: "frustrated", end: "frustrated" },
                    topics: ["duplicate_charge", "refund_request", "payment_error", "escalation"],
                    actionItems: ["Payments team callback within 60 minutes", "Process refund of $3,200 duplicate charge", "Agent to follow up if callback not made"],
                    followUpRequired: true,
                    keyEntities: { "booking_id": "BK-4421987", "property": "Park Hyatt Tokyo", "location": "Tokyo, Japan", "dates": "March 1-5, 2026", "duplicate_charge": "$3,200", "total_charged": "$6,400", "callback_number": "+1-555-234-8976", "callback_deadline": "60 minutes" },
                    summary: "Duplicate $3,200 charge escalated to payments team. Callback promised within 1 hour."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: false, reasoning: "Refund was not processed during conversation. Required handoff to payments team." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent repeatedly apologized, acknowledged financial impact, and offered callback instead of more hold time." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent correctly identified the duplicate charge from payment records and confirmed booking details." },
                    { criteriaId: "crit-004", criteriaName: "Handover Quality", passed: true, reasoning: "Comprehensive case created with booking ID, charge amounts, callback number, and urgency level. Set personal follow-up reminder." }
                ]
            },
            {
                id: "conv-007",
                date: "2026-01-19T14:00:00Z",
                duration: "1:15",
                messageCount: 7,
                channel: "chat",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Hi there! Welcome to StayEasy. How can I help?", timestamp: "00:00" },
                    { role: "customer", content: "What time is checkout at my hotel next week?", timestamp: "00:10" },
                    { role: "agent", content: "I'd be happy to check that for you. What's your booking confirmation number?", timestamp: "00:18" },
                    { role: "customer", content: "BK-6632198", timestamp: "00:28" },
                    { role: "agent", content: "I found your booking at The Shard Hotel in London, January 28-30. Standard checkout time is 11:00 AM. Would you like me to request late checkout?", timestamp: "00:38" },
                    { role: "customer", content: "No that's fine, 11 works. Thanks!", timestamp: "00:55" },
                    { role: "agent", content: "You're welcome! Enjoy your stay in London. Let me know if you need anything else.", timestamp: "01:02" }
                ],
                proseSummary: "Customer inquired about checkout time for The Shard Hotel London booking BK-6632198, January 28-30. Standard checkout is 11:00 AM. Customer confirmed this works for them. Agent offered late checkout option which was declined.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "neutral", end: "satisfied" },
                    topics: ["booking_inquiry", "checkout_time"],
                    actionItems: [],
                    followUpRequired: false,
                    keyEntities: { "booking_id": "BK-6632198", "property": "The Shard Hotel", "location": "London, UK", "dates": "January 28-30, 2026", "checkout_time": "11:00 AM" },
                    summary: "Simple checkout time inquiry. Standard 11AM checkout confirmed."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Customer's question was answered completely. Proactively offered late checkout option." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Friendly tone, wished customer well. Efficient response without being curt." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Correctly identified property and dates. Provided accurate checkout time." }
                ]
            },
            {
                id: "conv-008",
                date: "2026-01-19T11:30:00Z",
                duration: "2:48",
                messageCount: 14,
                channel: "voice",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Good morning, StayEasy booking assistant. How can I help you today?", timestamp: "00:00" },
                    { role: "customer", content: "Hi, I need to upgrade my room for my anniversary trip. We originally booked a standard room but I want to surprise my wife with something special.", timestamp: "00:10" },
                    { role: "agent", content: "How lovely! I'd be happy to help make your anniversary extra special. What's your booking confirmation number?", timestamp: "00:22" },
                    { role: "customer", content: "BK-3398456. It's at the Santorini Grace Hotel in Greece.", timestamp: "00:32" },
                    { role: "agent", content: "Beautiful choice for an anniversary! I can see your booking for June 15th to 20th, currently a Deluxe Room. Let me check what upgrade options are available...", timestamp: "00:45" },
                    { role: "customer", content: "Ideally something with a private pool or amazing view. Price isn't really an issue for this.", timestamp: "01:00" },
                    { role: "agent", content: "Perfect. I have three options: The Villa Suite with infinity plunge pool and caldera view at €450/night additional. The Honeymoon Suite with private hot tub and sunset view at €320/night additional. Or the Grace Suite with the largest private pool at €580/night additional.", timestamp: "01:18" },
                    { role: "customer", content: "The Villa Suite sounds perfect. The infinity pool with the caldera view - she's going to love that.", timestamp: "01:50" },
                    { role: "agent", content: "Excellent choice! For 5 nights, the upgrade cost is €2,250. Your new total would be €4,100. Would you like me to process this upgrade?", timestamp: "02:02" },
                    { role: "customer", content: "Yes please. Can you also add a note that it's our 10th anniversary? Maybe they can do something special?", timestamp: "02:15" },
                    { role: "agent", content: "Absolutely! I've upgraded you to the Villa Suite with infinity plunge pool and added a special occasion note for your 10th anniversary. The hotel often arranges romantic touches like champagne, flowers, or a special dinner setup. You'll receive an updated confirmation. Is there anything else?", timestamp: "02:28" },
                    { role: "customer", content: "That's perfect. Thank you so much!", timestamp: "02:40" }
                ],
                proseSummary: "Customer requested room upgrade for 10th anniversary trip to Santorini Grace Hotel (BK-3398456, June 15-20). Upgraded from Deluxe Room to Villa Suite with infinity plunge pool and caldera view. Additional cost €2,250 (€450/night x 5), new total €4,100. Anniversary celebration note added to booking for special touches.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "neutral", end: "satisfied" },
                    topics: ["room_upgrade", "special_occasion", "anniversary"],
                    actionItems: [],
                    followUpRequired: false,
                    keyEntities: { "booking_id": "BK-3398456", "property": "Santorini Grace Hotel", "location": "Santorini, Greece", "dates": "June 15-20, 2026", "original_room": "Deluxe Room", "new_room": "Villa Suite with infinity plunge pool", "upgrade_cost": "€2,250", "new_total": "€4,100", "special_occasion": "10th Anniversary" },
                    summary: "Anniversary trip upgraded to Villa Suite with private pool. Hotel notified of 10th anniversary for special touches."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Room upgrade completed with anniversary note added. Customer expressed satisfaction." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent was enthusiastic about the anniversary, complimented hotel choice, and proactively mentioned hotel's typical special touches." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Clearly presented three upgrade options with specific amenities and pricing. Calculated 5-night total correctly." },
                    { criteriaId: "crit-005", criteriaName: "Upsell Appropriateness", passed: true, reasoning: "Presented options at multiple price points without pressure. Let customer choose based on their stated preference for pool and view." }
                ]
            },
            {
                id: "conv-009",
                date: "2026-01-18T09:15:00Z",
                duration: "3:10",
                messageCount: 16,
                channel: "voice",
                status: "failed",
                transcript: [
                    { role: "agent", content: "Hello, StayEasy booking assistant. How can I help?", timestamp: "00:00" },
                    { role: "customer", content: "I need wheelchair accessible room for my Lisbon booking. I didn't realize when I booked that the standard rooms don't have accessibility features.", timestamp: "00:10" },
                    { role: "agent", content: "Of course, I'll help you find an accessible room. What's your confirmation number?", timestamp: "00:22" },
                    { role: "customer", content: "BK-8891234. Hotel Avenida Palace.", timestamp: "00:30" },
                    { role: "agent", content: "I found your booking for February 5th to 8th. Let me check the accessible room availability... I'm seeing that the Hotel Avenida Palace's accessible rooms are fully booked for those dates. I'm so sorry.", timestamp: "00:48" },
                    { role: "customer", content: "What? But I need an accessible room. My mother uses a wheelchair.", timestamp: "01:05" },
                    { role: "agent", content: "I completely understand, and I want to find a solution for you. Let me check other comparable hotels in Lisbon with accessible rooms available for your dates.", timestamp: "01:18" },
                    { role: "customer", content: "But I specifically chose this hotel for the location. It's close to where my family lives.", timestamp: "01:35" },
                    { role: "agent", content: "I understand the location is important. I found the Tivoli Avenida Liberdade, which is only 400 meters from Hotel Avenida Palace, has an accessible room available. Same star rating, and I can match your original rate.", timestamp: "01:52" },
                    { role: "customer", content: "I don't know... let me think about it. Can you hold my original booking while I discuss with my mother?", timestamp: "02:15" },
                    { role: "agent", content: "Absolutely. I'll place a 48-hour hold on both your original booking and the accessible room at Tivoli. I'll also email you the details of the Tivoli option so you can show your mother. Just call us back when you've decided.", timestamp: "02:30" },
                    { role: "customer", content: "Okay, thank you. I'll call back tomorrow.", timestamp: "02:50" }
                ],
                proseSummary: "Customer requested wheelchair accessible room for Hotel Avenida Palace Lisbon booking (BK-8891234, Feb 5-8). Original hotel has no accessible rooms available. Agent offered alternative at Tivoli Avenida Liberdade (400m away, same rate, accessible room available). Customer requested time to consider. 48-hour hold placed on both bookings. Details emailed to customer.",
                structuredSummary: {
                    outcome: "handed_over",
                    sentiment: { start: "neutral", end: "neutral" },
                    topics: ["accessibility", "room_change", "special_needs", "alternative_property"],
                    actionItems: ["Customer to call back within 48 hours with decision", "Hold expires on original booking and Tivoli alternative", "Follow up if no response in 48 hours"],
                    followUpRequired: true,
                    keyEntities: { "booking_id": "BK-8891234", "original_property": "Hotel Avenida Palace", "alternative_property": "Tivoli Avenida Liberdade", "location": "Lisbon, Portugal", "dates": "February 5-8, 2026", "accessibility_need": "Wheelchair accessible room", "hold_duration": "48 hours", "distance_between": "400 meters" },
                    summary: "Accessible room unavailable at original hotel. Alternative offered at Tivoli (400m away). Customer deciding - 48hr hold on both."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: false, reasoning: "Customer's need for accessible room was not fully resolved. Awaiting customer decision on alternative property." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent acknowledged importance of location, found nearby alternative, and gave customer time to decide with family." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Agent correctly identified accessibility limitation at original property and found comparable alternative with accurate distance information." },
                    { criteriaId: "crit-007", criteriaName: "Accessibility Handling", passed: true, reasoning: "Agent took accessibility request seriously, proactively searched alternatives, and ensured customer wouldn't lose either option while deciding." }
                ]
            },
            {
                id: "conv-010",
                date: "2026-01-17T15:45:00Z",
                duration: "1:55",
                messageCount: 10,
                channel: "chat",
                status: "successful",
                transcript: [
                    { role: "agent", content: "Hi! How can I help you today?", timestamp: "00:00" },
                    { role: "customer", content: "I need to add breakfast to my booking. BK-2245671 at the Mandarin Oriental Bangkok", timestamp: "00:12" },
                    { role: "agent", content: "I'd be happy to add breakfast. Let me pull up your booking... Found it! March 10-14, Executive Room. The daily breakfast buffet is $45 per person. With 2 guests for 4 nights, that would be $360 total. Would you like me to add this?", timestamp: "00:25" },
                    { role: "customer", content: "Actually is there a cheaper continental option?", timestamp: "00:48" },
                    { role: "agent", content: "Yes! The continental breakfast is $28 per person per day. For 2 guests over 4 nights, that would be $224 total. This includes pastries, fresh fruit, yogurt, coffee and juice.", timestamp: "01:00" },
                    { role: "customer", content: "That's better. Let's go with the continental.", timestamp: "01:18" },
                    { role: "agent", content: "I've added continental breakfast for 2 guests to your booking. Your updated total is $1,824 (was $1,600). Breakfast is served 6:30-10:30 AM in the River Wing restaurant. Confirmation email on its way!", timestamp: "01:32" },
                    { role: "customer", content: "Great, thanks!", timestamp: "01:48" }
                ],
                proseSummary: "Customer added continental breakfast to Mandarin Oriental Bangkok booking (BK-2245671, March 10-14). Selected continental option ($28/person/day) over buffet ($45/person/day). Total breakfast cost: $224 for 2 guests x 4 nights. New booking total: $1,824. Breakfast served 6:30-10:30 AM at River Wing restaurant.",
                structuredSummary: {
                    outcome: "resolved",
                    sentiment: { start: "neutral", end: "satisfied" },
                    topics: ["add_breakfast", "booking_modification", "meal_package"],
                    actionItems: [],
                    followUpRequired: false,
                    keyEntities: { "booking_id": "BK-2245671", "property": "Mandarin Oriental Bangkok", "location": "Bangkok, Thailand", "dates": "March 10-14, 2026", "breakfast_type": "Continental", "breakfast_cost": "$224 total", "breakfast_time": "6:30-10:30 AM", "restaurant": "River Wing", "new_total": "$1,824" },
                    summary: "Continental breakfast added for 2 guests ($224 total). Served 6:30-10:30 AM at River Wing."
                },
                evaluationResults: [
                    { criteriaId: "crit-001", criteriaName: "Issue Resolution", passed: true, reasoning: "Breakfast successfully added. Customer received pricing options and made informed choice." },
                    { criteriaId: "crit-002", criteriaName: "Empathy & Tone", passed: true, reasoning: "Agent efficiently handled request and provided helpful details about what's included and timing." },
                    { criteriaId: "crit-003", criteriaName: "Booking Accuracy", passed: true, reasoning: "Correct pricing for both options. Accurate calculation of total (2 guests x 4 nights x $28 = $224)." },
                    { criteriaId: "crit-005", criteriaName: "Upsell Appropriateness", passed: true, reasoning: "Presented premium option first but immediately offered budget alternative when customer asked. No pressure tactics." }
                ]
            }
        ];

        // Utility Functions
        const formatDate = (dateStr) => {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        };

        const getTimeAgo = (dateStr) => {
            const now = new Date();
            const date = new Date(dateStr);
            const diff = Math.floor((now - date) / 1000);
            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        };

        // Icons
        const Icons = {
            Logo: () => (
                <svg className="w-8 h-8" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="8" fill="#10b981"/>
                    <path d="M8 16L14 22L24 10" stroke="white" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
            ),
            Chat: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>,
            Chart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>,
            Settings: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>,
            Refresh: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>,
            Search: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>,
            User: () => <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>,
            Bot: () => <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 011 1v3a1 1 0 01-1 1h-1v1a2 2 0 01-2 2H6a2 2 0 01-2-2v-1H3a1 1 0 01-1-1v-3a1 1 0 011-1h1a7 7 0 017-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 012-2M9 14a1 1 0 100 2 1 1 0 000-2m6 0a1 1 0 100 2 1 1 0 000-2"/></svg>,
            Phone: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>,
            Message: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>,
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"/></svg>,
            X: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"/></svg>,
            Flag: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/></svg>,
            Agents: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>,
            Knowledge: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>,
            Tool: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>,
            ChevronDown: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"/></svg>,
            Plus: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4"/></svg>,
            Clipboard: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>,
            Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>,
            TrendingUp: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>,
            Clock: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>,
            Menu: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"/></svg>,
            ChevronLeft: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"/></svg>,
            ChevronRight: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"/></svg>,
        };

        // Components
        const NavSidebar = ({ conversationFilter, setConversationFilter, isCollapsed, onToggleCollapse }) => {
            const [agentDropdownOpen, setAgentDropdownOpen] = useState(false);
            const [conversationsDropdownOpen, setConversationsDropdownOpen] = useState(true);

            const buildItems = [
                { id: 'agents', icon: Icons.Agents, label: 'Agents', hasDropdown: true },
                { id: 'knowledge', icon: Icons.Knowledge, label: 'Knowledge Base' },
                { id: 'tools', icon: Icons.Tool, label: 'Tools' }
            ];

            const conversationSubItems = [
                { id: 'resolved', label: 'Resolved' },
                { id: 'escalated', label: 'Escalated & Handoff' },
                { id: 'pending', label: 'Pending' },
                { id: 'evaluate', label: 'Evaluate' }
            ];

            if (isCollapsed) {
                return (
                    <nav className="w-16 bg-se-darker border-r border-se-border flex flex-col py-4 items-center transition-all duration-200">
                        <div className="mb-6">
                            <Icons.Logo />
                        </div>
                        <button
                            onClick={onToggleCollapse}
                            className="p-2 rounded-lg text-se-muted hover:bg-se-hover hover:text-se-text mb-4"
                            title="Expand menu">
                            <Icons.ChevronRight />
                        </button>
                        <div className="flex flex-col gap-2">
                            {buildItems.map(({ id, icon: Icon, label }) => (
                                <button key={id} className="p-2 rounded-lg text-se-muted hover:bg-se-hover hover:text-se-text" title={label}>
                                    <Icon />
                                </button>
                            ))}
                        </div>
                        <div className="my-4 w-8 border-t border-se-border"></div>
                        <div className="flex flex-col gap-2">
                            <button
                                onClick={() => setConversationFilter('all')}
                                className={`p-2 rounded-lg ${conversationFilter === 'all' || ['resolved', 'escalated', 'pending', 'evaluate'].includes(conversationFilter) ? 'bg-se-accent text-white' : 'text-se-muted hover:bg-se-hover hover:text-se-text'}`}
                                title="All conversations">
                                <Icons.Chat />
                            </button>
                        </div>
                        <div className="mt-auto flex flex-col gap-2">
                            <button className="p-2 rounded-lg text-se-muted hover:bg-se-hover hover:text-se-text" title="Analytics">
                                <Icons.Chart />
                            </button>
                            <button className="p-2 rounded-lg text-se-muted hover:bg-se-hover hover:text-se-text" title="Settings">
                                <Icons.Settings />
                            </button>
                        </div>
                    </nav>
                );
            }

            return (
                <nav className="w-52 bg-se-darker border-r border-se-border flex flex-col py-4 transition-all duration-200">
                    <div className="px-4 mb-6 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                            <Icons.Logo />
                            <span className="font-semibold text-se-text">StayEasy</span>
                        </div>
                        <button
                            onClick={onToggleCollapse}
                            className="p-1 rounded text-se-muted hover:bg-se-hover hover:text-se-text"
                            title="Collapse menu">
                            <Icons.ChevronLeft />
                        </button>
                    </div>

                    {/* Build Section */}
                    <div className="px-4 mb-2">
                        <span className="text-xs font-medium text-se-muted uppercase tracking-wider">Build</span>
                    </div>
                    <div className="flex flex-col gap-1 px-2 mb-4">
                        {buildItems.map(({ id, icon: Icon, label, hasDropdown }) => (
                            <div key={id} className="relative">
                                <button
                                    onClick={() => hasDropdown && setAgentDropdownOpen(!agentDropdownOpen)}
                                    className="w-full px-3 py-2 rounded-lg text-left text-sm flex items-center justify-between transition-colors text-se-muted hover:bg-se-hover hover:text-se-text">
                                    <div className="flex items-center gap-2">
                                        <Icon /> {label}
                                    </div>
                                    {hasDropdown && (
                                        <div className={`transition-transform ${agentDropdownOpen ? 'rotate-180' : ''}`}>
                                            <Icons.ChevronDown />
                                        </div>
                                    )}
                                </button>
                                {hasDropdown && agentDropdownOpen && (
                                    <div className="ml-6 mt-1 flex flex-col gap-1">
                                        <button className="px-3 py-1.5 rounded text-left text-xs text-se-muted hover:bg-se-hover hover:text-se-text transition-colors">
                                            Bert - Booking Assistant
                                        </button>
                                        <button className="px-3 py-1.5 rounded text-left text-xs text-se-accent hover:bg-se-hover transition-colors">
                                            + Create new agent
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>

                    {/* Conversations Section */}
                    <div className="px-4 mb-2">
                        <span className="text-xs font-medium text-se-muted uppercase tracking-wider">Conversations</span>
                    </div>
                    <div className="flex flex-col gap-1 px-2">
                        {/* All Conversations with dropdown */}
                        <div className="relative">
                            <button
                                onClick={() => {
                                    setConversationFilter('all');
                                    setConversationsDropdownOpen(!conversationsDropdownOpen);
                                }}
                                className={`w-full px-3 py-2 rounded-lg text-left text-sm flex items-center justify-between transition-colors ${conversationFilter === 'all' ? 'bg-se-accent text-white' : 'text-se-muted hover:bg-se-hover hover:text-se-text'}`}>
                                <div className="flex items-center gap-2">
                                    <Icons.Chat /> All conversations
                                </div>
                                <div className={`transition-transform ${conversationsDropdownOpen ? 'rotate-180' : ''}`}>
                                    <Icons.ChevronDown />
                                </div>
                            </button>
                            {conversationsDropdownOpen && (
                                <div className="ml-6 mt-1 flex flex-col gap-1">
                                    {conversationSubItems.map(({ id, label }) => (
                                        <button key={id} onClick={() => setConversationFilter(id)}
                                            className={`px-3 py-1.5 rounded text-left text-xs transition-colors ${conversationFilter === id ? 'text-se-accent font-medium' : 'text-se-muted hover:bg-se-hover hover:text-se-text'}`}>
                                            {label}
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="mt-auto px-2 flex flex-col gap-1">
                        {[{ id: 'analytics', icon: Icons.Chart, label: 'Analytics' }, { id: 'settings', icon: Icons.Settings, label: 'Settings' }].map(({ id, icon: Icon, label }) => (
                            <button key={id}
                                className="px-3 py-2 rounded-lg text-left text-sm flex items-center gap-2 transition-colors text-se-muted hover:bg-se-hover hover:text-se-text">
                                <Icon /> {label}
                            </button>
                        ))}
                    </div>
                </nav>
            );
        };

        const OutcomeBadge = ({ outcome }) => {
            const styles = {
                resolved: 'bg-se-success/20 text-se-success',
                handed_over: 'bg-se-warning/20 text-se-warning',
                escalated: 'bg-se-error/20 text-se-error',
                abandoned: 'bg-se-muted/20 text-se-muted'
            };
            const labels = {
                resolved: 'Resolved',
                handed_over: 'Handed Over',
                escalated: 'Escalated',
                abandoned: 'Abandoned'
            };
            return <span className={`px-2 py-0.5 rounded text-xs font-medium ${styles[outcome] || styles.abandoned}`}>{labels[outcome] || outcome}</span>;
        };

        const SentimentIndicator = ({ sentiment }) => {
            const colors = {
                frustrated: 'text-se-error',
                neutral: 'text-se-muted',
                satisfied: 'text-se-success'
            };
            return (
                <div className="flex items-center gap-1 text-xs">
                    <span className={colors[sentiment.start]}>{sentiment.start}</span>
                    <span className="text-se-muted">→</span>
                    <span className={colors[sentiment.end]}>{sentiment.end}</span>
                </div>
            );
        };

        const ChannelIcon = ({ channel }) => (
            channel === 'voice' ? <Icons.Phone /> : <Icons.Message />
        );

        const ConversationCard = ({ conversation, isSelected, onClick }) => (
            <div onClick={onClick}
                className={`p-3 rounded-lg cursor-pointer transition-all border ${isSelected ? 'bg-se-accent/10 border-se-accent' : 'bg-se-card border-transparent hover:bg-se-hover'}`}>
                <div className="flex items-start justify-between mb-2">
                    <div className="flex items-center gap-2">
                        <div className={`w-7 h-7 rounded-full flex items-center justify-center ${conversation.channel === 'voice' ? 'bg-se-blue/20 text-se-blue' : 'bg-se-accent/20 text-se-accent'}`}>
                            <ChannelIcon channel={conversation.channel} />
                        </div>
                        <div>
                            <span className="text-sm font-medium text-se-text block">{conversation.structuredSummary.keyEntities.property || conversation.id}</span>
                            <span className="text-xs text-se-muted">{getTimeAgo(conversation.date)}</span>
                        </div>
                    </div>
                    <OutcomeBadge outcome={conversation.structuredSummary.outcome} />
                </div>
                <p className="text-xs text-se-muted mb-2 line-clamp-2">{conversation.structuredSummary.summary}</p>
                <div className="flex items-center justify-between">
                    <span className="text-xs text-se-muted">{conversation.duration} · {conversation.messageCount} msgs</span>
                    <SentimentIndicator sentiment={conversation.structuredSummary.sentiment} />
                </div>
                {conversation.structuredSummary.followUpRequired && (
                    <div className="mt-2 flex items-center gap-1 text-xs text-se-warning">
                        <Icons.Flag /> Follow-up needed
                    </div>
                )}
            </div>
        );

        const ConversationList = ({ conversations, selectedId, onSelect, filter, search, setSearch, loading, error, onRefresh, useMockData, onToggleDataSource }) => {
            const filtered = useMemo(() => conversations.filter(c => {
                const outcome = c.structuredSummary.outcome;
                if (filter === 'resolved' && outcome !== 'resolved') return false;
                if (filter === 'escalated' && !['escalated', 'handed_over'].includes(outcome)) return false;
                if (filter === 'pending' && outcome !== 'abandoned') return false;
                if (search && !c.id.toLowerCase().includes(search.toLowerCase()) &&
                    !c.structuredSummary.summary.toLowerCase().includes(search.toLowerCase()) &&
                    !(c.structuredSummary.keyEntities.property || '').toLowerCase().includes(search.toLowerCase())) return false;
                return true;
            }), [conversations, filter, search]);

            const stats = useMemo(() => ({
                total: conversations.length,
                resolved: conversations.filter(c => c.structuredSummary.outcome === 'resolved').length,
                escalated: conversations.filter(c => ['escalated', 'handed_over'].includes(c.structuredSummary.outcome)).length,
                followUp: conversations.filter(c => c.structuredSummary.followUpRequired).length
            }), [conversations]);

            return (
                <div className="w-80 bg-se-darker border-r border-se-border flex flex-col h-full">
                    <div className="p-4 border-b border-se-border">
                        <div className="flex items-center justify-between mb-3">
                            <span className="text-sm font-medium">Conversations</span>
                            <div className="flex items-center gap-2">
                                <span className="text-xs text-se-muted">{filtered.length} of {stats.total}</span>
                                <button onClick={onRefresh} disabled={loading}
                                    className={`p-1.5 rounded text-se-muted hover:text-se-text hover:bg-se-hover transition-colors ${loading ? 'animate-spin' : ''}`}
                                    title="Refresh conversations">
                                    <Icons.Refresh />
                                </button>
                            </div>
                        </div>
                        <div className="flex items-center justify-between mb-3">
                            <button onClick={onToggleDataSource}
                                className={`px-2 py-1 rounded text-xs font-medium transition-colors ${useMockData ? 'bg-se-warning/20 text-se-warning' : 'bg-se-success/20 text-se-success'}`}>
                                {useMockData ? 'Mock Data' : 'Live API'}
                            </button>
                            {error && <span className="text-xs text-se-error">Error: {error}</span>}
                        </div>
                        <div className="relative">
                            <input type="text" placeholder="Search by property or topic..."
                                value={search} onChange={e => setSearch(e.target.value)}
                                className="w-full pl-9 pr-3 py-2 bg-se-card border border-se-border rounded-lg text-sm placeholder-se-muted focus:outline-none focus:border-se-accent" />
                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-se-muted"><Icons.Search /></div>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-3 space-y-2">
                        {loading ? (
                            <div className="text-center py-8">
                                <div className="w-8 h-8 border-2 border-se-accent border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
                                <span className="text-se-muted text-sm">Loading conversations...</span>
                            </div>
                        ) : filtered.length === 0 ? (
                            <div className="text-center py-8 text-se-muted text-sm">No conversations found</div>
                        ) : (
                            filtered.map(c => (
                                <ConversationCard key={c.id} conversation={c}
                                    isSelected={selectedId === c.id} onClick={() => onSelect(c.id)} />
                            ))
                        )}
                    </div>
                    <div className="p-4 border-t border-se-border bg-se-card/50">
                        <div className="flex justify-between text-xs">
                            <span className="text-se-muted">Resolved: <span className="text-se-success font-medium">{stats.resolved}</span></span>
                            <span className="text-se-muted">Escalated: <span className="text-se-warning font-medium">{stats.escalated}</span></span>
                            <span className="text-se-muted">Follow-up: <span className="text-se-error font-medium">{stats.followUp}</span></span>
                        </div>
                    </div>
                </div>
            );
        };

        const TranscriptMessage = ({ entry }) => {
            const isAgent = entry.role === 'agent';
            return (
                <div className={`flex gap-3 ${isAgent ? '' : 'flex-row-reverse'}`}>
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${isAgent ? 'bg-se-accent' : 'bg-se-card'}`}>
                        {isAgent ? <Icons.Bot /> : <Icons.User />}
                    </div>
                    <div className={`max-w-[70%] ${isAgent ? '' : 'text-right'}`}>
                        <div className={`px-4 py-2.5 rounded-2xl ${isAgent ? 'bg-se-card rounded-tl-sm' : 'bg-se-accent rounded-tr-sm'}`}>
                            <p className="text-sm leading-relaxed">{entry.content}</p>
                        </div>
                        <span className="text-xs text-se-muted mt-1 inline-block">{entry.timestamp}</span>
                    </div>
                </div>
            );
        };

        const EvaluationCard = ({ result }) => (
            <div className={`p-3 rounded-lg border ${result.passed ? 'bg-se-success/5 border-se-success/30' : 'bg-se-error/5 border-se-error/30'}`}>
                <div className="flex items-center gap-2 mb-2">
                    <div className={`w-5 h-5 rounded-full flex items-center justify-center ${result.passed ? 'bg-se-success/20 text-se-success' : 'bg-se-error/20 text-se-error'}`}>
                        {result.passed ? <Icons.Check /> : <Icons.X />}
                    </div>
                    <span className="text-sm font-medium">{result.criteriaName}</span>
                </div>
                <p className="text-xs text-se-muted leading-relaxed">{result.reasoning}</p>
            </div>
        );

        const SummaryPanel = ({ conversation, evaluationCriteria, isCollapsed, onToggleCollapse }) => {
            const { structuredSummary, evaluationResults, proseSummary } = conversation;

            // Generate evaluation results based on criteria (simulated for now)
            const criteriaBasedResults = evaluationCriteria ? evaluationCriteria.map(c => {
                // Check if we have an existing result for this criteria
                const existing = evaluationResults.find(r => r.criteriaId === c.id || r.criteriaName === c.name);
                if (existing) return existing;
                // Simulate result based on conversation outcome
                const passed = structuredSummary.outcome === 'resolved' ? Math.random() > 0.2 : Math.random() > 0.6;
                return {
                    criteriaId: c.id,
                    criteriaName: c.name,
                    passed,
                    reasoning: passed ? `Conversation meets ${c.name.toLowerCase()} criteria based on ${c.instructions.slice(0, 50)}...` : `Did not meet ${c.name.toLowerCase()} standards.`
                };
            }) : evaluationResults;

            if (isCollapsed) {
                return (
                    <div className="w-12 bg-se-darker border-l border-se-border flex flex-col items-center py-4 transition-all duration-200">
                        <button
                            onClick={onToggleCollapse}
                            className="p-2 rounded-lg text-se-muted hover:bg-se-hover hover:text-se-text"
                            title="Expand AI Summary">
                            <Icons.ChevronLeft />
                        </button>
                        <div className="mt-4 writing-mode-vertical text-xs text-se-muted font-medium" style={{ writingMode: 'vertical-rl', textOrientation: 'mixed' }}>
                            AI Summary
                        </div>
                    </div>
                );
            }

            return (
                <div className="w-96 bg-se-darker border-l border-se-border p-4 overflow-y-auto transition-all duration-200">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="text-sm font-semibold text-se-text">AI Summary</h3>
                        <button
                            onClick={onToggleCollapse}
                            className="p-1 rounded text-se-muted hover:bg-se-hover hover:text-se-text"
                            title="Collapse AI Summary">
                            <Icons.ChevronRight />
                        </button>
                    </div>

                    <div className="space-y-4">
                        <div>
                            <h4 className="text-xs font-medium text-se-muted mb-2">Summary</h4>
                            <p className="text-sm text-se-text leading-relaxed">{proseSummary}</p>
                        </div>

                        <div className="flex items-center gap-2 flex-wrap">
                            <OutcomeBadge outcome={structuredSummary.outcome} />
                            <SentimentIndicator sentiment={structuredSummary.sentiment} />
                            {structuredSummary.followUpRequired && (
                                <span className="px-2 py-0.5 rounded text-xs font-medium bg-se-warning/20 text-se-warning">Follow-up</span>
                            )}
                        </div>

                        <div>
                            <h4 className="text-xs font-medium text-se-muted mb-2">Topics</h4>
                            <div className="flex flex-wrap gap-1.5">
                                {structuredSummary.topics.map((topic, i) => (
                                    <span key={i} className="px-2 py-1 bg-se-accent/20 text-se-accent text-xs rounded-full">{topic.replace(/_/g, ' ')}</span>
                                ))}
                            </div>
                        </div>

                        {structuredSummary.actionItems.length > 0 && (
                            <div>
                                <h4 className="text-xs font-medium text-se-muted mb-2">Action Items</h4>
                                <ul className="space-y-1">
                                    {structuredSummary.actionItems.map((item, i) => (
                                        <li key={i} className="flex items-start gap-2 text-sm text-se-text">
                                            <div className="w-1.5 h-1.5 rounded-full bg-se-warning mt-1.5 flex-shrink-0" />
                                            {item}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        <div>
                            <h4 className="text-xs font-medium text-se-muted mb-2">Booking Details</h4>
                            <dl className="space-y-1.5 text-xs">
                                {Object.entries(structuredSummary.keyEntities).map(([key, value]) => (
                                    <div key={key} className="flex justify-between">
                                        <dt className="text-se-muted">{key.replace(/_/g, ' ')}</dt>
                                        <dd className="text-se-text font-medium text-right max-w-[180px]">{value}</dd>
                                    </div>
                                ))}
                            </dl>
                        </div>

                        <div className="pt-4 border-t border-se-border">
                            <h4 className="text-xs font-medium text-se-muted mb-3">
                                {evaluationCriteria ? 'Criteria Evaluation' : 'Quality Evaluation'}
                            </h4>
                            <div className="space-y-2">
                                {criteriaBasedResults.map((result, i) => (
                                    <EvaluationCard key={i} result={result} />
                                ))}
                            </div>
                            {evaluationCriteria && (
                                <p className="text-xs text-se-muted mt-3 italic">Evaluations based on your custom criteria</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ConversationDetail = ({ conversation, evaluationCriteria }) => {
            const [summaryCollapsed, setSummaryCollapsed] = useState(false);

            if (!conversation) {
                return (
                    <div className="flex-1 flex items-center justify-center bg-se-dark">
                        <div className="text-center">
                            <div className="w-16 h-16 rounded-full bg-se-card flex items-center justify-center mx-auto mb-4">
                                <Icons.Chat />
                            </div>
                            <p className="text-se-muted">Select a conversation to view details</p>
                        </div>
                    </div>
                );
            }

            const property = conversation.structuredSummary.keyEntities.property || conversation.structuredSummary.keyEntities.original_property || 'Booking';
            const location = conversation.structuredSummary.keyEntities.location || '';

            return (
                <div className="flex-1 flex flex-col bg-se-dark">
                    <div className="p-4 border-b border-se-border">
                        <div className="flex items-center justify-between">
                            <div>
                                <div className="flex items-center gap-3 mb-1">
                                    <h2 className="text-lg font-semibold">{property}</h2>
                                    <OutcomeBadge outcome={conversation.structuredSummary.outcome} />
                                    <div className={`px-2 py-0.5 rounded text-xs font-medium flex items-center gap-1 ${conversation.channel === 'voice' ? 'bg-se-blue/20 text-se-blue' : 'bg-se-accent/20 text-se-accent'}`}>
                                        <ChannelIcon channel={conversation.channel} /> {conversation.channel}
                                    </div>
                                </div>
                                <div className="flex items-center gap-4 text-sm text-se-muted">
                                    {location && <span>{location}</span>}
                                    <span>{formatDate(conversation.date)}</span>
                                    <span>{conversation.duration}</span>
                                    <span>{conversation.messageCount} messages</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="flex-1 flex overflow-hidden">
                        <div className="flex-1 p-4 overflow-y-auto space-y-4">
                            {conversation.transcript.map((entry, i) => <TranscriptMessage key={i} entry={entry} />)}
                        </div>
                        <SummaryPanel
                            conversation={conversation}
                            evaluationCriteria={evaluationCriteria}
                            isCollapsed={summaryCollapsed}
                            onToggleCollapse={() => setSummaryCollapsed(!summaryCollapsed)}
                        />
                    </div>
                </div>
            );
        };

        // API Configuration
        const API_BASE = '/api';
        const USE_LIVE_API = true; // Toggle to switch between live API and mock data

        // Transform ElevenLabs conversation to dashboard format
        const transformConversation = (conv, details = null) => {
            // Basic info from list API
            const base = {
                id: conv.conversation_id || conv.id,
                date: conv.start_time || conv.created_at || new Date().toISOString(),
                duration: conv.call_duration ? formatDuration(conv.call_duration) : '0:00',
                messageCount: details?.transcript?.length || conv.turn_count || 0,
                channel: 'voice',
                status: conv.status || 'successful',
            };

            // If we have full details, use them
            if (details) {
                const transcript = (details.transcript || []).map((msg, idx) => ({
                    role: msg.role === 'agent' ? 'agent' : 'customer',
                    content: msg.message || msg.text || '',
                    timestamp: formatTimestamp(idx * 10) // Approximate timestamps
                }));

                // Extract analysis if available
                const analysis = details.analysis || {};

                return {
                    ...base,
                    messageCount: transcript.length,
                    transcript,
                    proseSummary: analysis.summary || analysis.call_summary || 'Conversation with voice agent.',
                    structuredSummary: {
                        outcome: mapStatus(conv.status, analysis),
                        sentiment: {
                            start: analysis.user_sentiment_start || 'neutral',
                            end: analysis.user_sentiment_end || analysis.user_sentiment || 'neutral'
                        },
                        topics: analysis.topics || analysis.data_collection_results?.topics || ['general_inquiry'],
                        actionItems: analysis.action_items || [],
                        followUpRequired: analysis.follow_up_required || false,
                        keyEntities: extractEntities(analysis, details),
                        summary: analysis.summary || analysis.call_summary || 'Voice agent conversation.'
                    },
                    evaluationResults: (analysis.evaluation_results || []).map(er => ({
                        criteriaId: er.criteria_id || er.id,
                        criteriaName: er.criteria_name || er.name || 'Evaluation',
                        passed: er.passed ?? er.result === 'pass',
                        reasoning: er.reasoning || er.rationale || ''
                    }))
                };
            }

            // Minimal version without details
            return {
                ...base,
                transcript: [],
                proseSummary: 'Loading conversation details...',
                structuredSummary: {
                    outcome: mapStatus(conv.status),
                    sentiment: { start: 'neutral', end: 'neutral' },
                    topics: ['voice_call'],
                    actionItems: [],
                    followUpRequired: false,
                    keyEntities: { conversation_id: base.id },
                    summary: 'Voice agent conversation'
                },
                evaluationResults: []
            };
        };

        const formatDuration = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        const formatTimestamp = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        };

        const mapStatus = (status, analysis = {}) => {
            if (analysis.outcome) return analysis.outcome;
            const statusMap = {
                'done': 'resolved',
                'completed': 'resolved',
                'success': 'resolved',
                'successful': 'resolved',
                'failed': 'abandoned',
                'error': 'abandoned',
                'transferred': 'handed_over',
                'escalated': 'escalated'
            };
            return statusMap[status?.toLowerCase()] || 'resolved';
        };

        const extractEntities = (analysis, details) => {
            const entities = {};
            if (analysis.data_collection_results) {
                Object.entries(analysis.data_collection_results).forEach(([key, value]) => {
                    if (value && typeof value === 'string') {
                        entities[key] = value;
                    }
                });
            }
            if (details.agent_id) entities.agent_id = details.agent_id;
            if (details.conversation_id) entities.conversation_id = details.conversation_id;
            return Object.keys(entities).length > 0 ? entities : { conversation_id: details.conversation_id };
        };

        // Default Evaluation Criteria
        const DEFAULT_CRITERIA = [
            { id: 'issue_resolved', name: 'Issue Resolved', description: "Evaluate whether the customer's original issue was fully resolved.", instructions: 'Mark as successful if the agent provided a complete solution or answer, or appropriately escalated to a human agent.', passRate: 84, icon: 'Check' },
            { id: 'efficient_handling', name: 'Efficient Handling', description: 'Assess if the agent handled the conversation efficiently.', instructions: 'Evaluate based on response time, number of unnecessary messages, and directness of communication.', passRate: 91, icon: 'Clock' },
            { id: 'positive_outcome', name: 'Positive Outcome', description: 'Determine if the customer left with a positive impression.', instructions: 'Consider customer sentiment, explicit feedback, and whether they thanked the agent or expressed satisfaction.', passRate: 78, icon: 'TrendingUp' },
        ];

        // Evaluate Table View Component
        const EvaluateTableView = ({ conversations, selectedId, onSelect, search, setSearch }) => {
            const filteredConversations = conversations.filter(c => {
                const property = c.structuredSummary?.keyEntities?.property || 'Conversation';
                return property.toLowerCase().includes(search.toLowerCase()) ||
                       c.proseSummary?.toLowerCase().includes(search.toLowerCase());
            });

            const getStatusBadge = (status) => {
                const statusMap = {
                    'successful': { label: 'Successful', style: 'bg-se-success/20 text-se-success' },
                    'resolved': { label: 'Successful', style: 'bg-se-success/20 text-se-success' },
                    'failed': { label: 'Failed', style: 'bg-se-error/20 text-se-error' },
                    'escalated': { label: 'Failed', style: 'bg-se-error/20 text-se-error' },
                    'abandoned': { label: 'Failed', style: 'bg-se-error/20 text-se-error' },
                    'pending': { label: 'Pending', style: 'bg-se-warning/20 text-se-warning' }
                };
                const { label, style } = statusMap[status] || statusMap.successful;
                return <span className={`px-2 py-1 rounded text-xs font-medium ${style}`}>{label}</span>;
            };

            const getConversationTitle = (c) => {
                const property = c.structuredSummary?.keyEntities?.property;
                if (property) return property;
                const topics = c.structuredSummary?.topics || [];
                if (topics.length > 0) return topics[0].replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                return 'Conversation';
            };

            return (
                <div className="flex-1 flex flex-col bg-se-dark overflow-hidden">
                    {/* Search Bar */}
                    <div className="p-4">
                        <div className="relative">
                            <Icons.Search />
                            <input
                                type="text"
                                placeholder="Search conversations..."
                                value={search}
                                onChange={(e) => setSearch(e.target.value)}
                                className="w-full pl-10 pr-4 py-2.5 bg-se-card border border-se-border rounded-lg text-sm text-se-text placeholder-se-muted focus:outline-none focus:border-se-accent"
                                style={{ paddingLeft: '2.5rem' }}
                            />
                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-se-muted">
                                <Icons.Search />
                            </div>
                        </div>
                    </div>

                    {/* Table */}
                    <div className="flex-1 overflow-auto px-4 pb-4">
                        <div className="bg-se-card rounded-lg border border-se-border overflow-hidden">
                            {/* Table Header */}
                            <div className="grid grid-cols-4 gap-4 px-4 py-3 border-b border-se-border text-xs font-medium text-se-muted uppercase tracking-wider">
                                <div>Conversation</div>
                                <div>Duration</div>
                                <div>Messages</div>
                                <div>Status</div>
                            </div>

                            {/* Table Rows */}
                            <div className="divide-y divide-se-border">
                                {filteredConversations.map((c) => (
                                    <div
                                        key={c.id}
                                        onClick={() => onSelect(c.id)}
                                        className={`grid grid-cols-4 gap-4 px-4 py-4 cursor-pointer transition-colors hover:bg-se-hover ${selectedId === c.id ? 'bg-se-hover' : ''}`}>
                                        <div>
                                            <div className="text-sm font-medium text-se-text">{getConversationTitle(c)}</div>
                                            <div className="text-xs text-se-muted">{formatDate(c.date)}</div>
                                        </div>
                                        <div className="text-sm text-se-muted self-center">{c.duration}</div>
                                        <div className="text-sm text-se-muted self-center">{c.messageCount}</div>
                                        <div className="self-center">{getStatusBadge(c.structuredSummary?.outcome || c.status)}</div>
                                    </div>
                                ))}
                            </div>

                            {filteredConversations.length === 0 && (
                                <div className="px-4 py-8 text-center text-se-muted text-sm">
                                    No conversations found
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Evaluation Criteria Panel Component
        const EvaluationCriteriaPanel = ({ criteria, onAdd, onEdit, isCollapsed, onToggleCollapse }) => {
            const getIcon = (iconName) => {
                const iconMap = { Check: Icons.Check, Clock: Icons.Clock, TrendingUp: Icons.TrendingUp };
                const Icon = iconMap[iconName] || Icons.Clipboard;
                return <Icon />;
            };

            if (isCollapsed) {
                return (
                    <div className="w-12 bg-se-darker border-l border-se-border flex flex-col items-center py-4 transition-all duration-200">
                        <button
                            onClick={onToggleCollapse}
                            className="p-2 rounded-lg text-se-muted hover:bg-se-hover hover:text-se-text"
                            title="Expand Criteria">
                            <Icons.ChevronLeft />
                        </button>
                        <div className="mt-4 writing-mode-vertical text-xs text-se-muted font-medium" style={{ writingMode: 'vertical-rl', textOrientation: 'mixed' }}>
                            Criteria
                        </div>
                    </div>
                );
            }

            return (
                <div className="w-80 bg-se-darker border-l border-se-border p-4 overflow-y-auto transition-all duration-200">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="text-sm font-semibold text-se-text">Evaluation Criteria</h3>
                        <div className="flex items-center gap-2">
                            <button onClick={onAdd} className="p-1.5 rounded bg-se-accent/20 text-se-accent hover:bg-se-accent/30 transition-colors">
                                <Icons.Plus />
                            </button>
                            <button
                                onClick={onToggleCollapse}
                                className="p-1 rounded text-se-muted hover:bg-se-hover hover:text-se-text"
                                title="Collapse Criteria">
                                <Icons.ChevronRight />
                            </button>
                        </div>
                    </div>
                    <div className="space-y-3">
                        {criteria.map((c) => (
                            <div key={c.id} onClick={() => onEdit(c)}
                                className="p-3 rounded-lg border border-se-border bg-se-card hover:border-se-accent/50 hover:bg-se-hover transition-all cursor-pointer">
                                <div className="flex items-center gap-2 mb-1">
                                    <div className="p-1.5 bg-se-border rounded text-se-accent">{getIcon(c.icon)}</div>
                                    <span className="text-sm font-medium text-se-text">{c.name}</span>
                                </div>
                                <p className="text-xs text-se-muted mb-2 ml-8">{c.description}</p>
                                <div className="flex items-center gap-2">
                                    <div className="flex-1 h-1.5 bg-se-border rounded-full overflow-hidden">
                                        <div className="h-full bg-se-accent rounded-full transition-all" style={{ width: `${c.passRate}%` }} />
                                    </div>
                                    <span className="text-xs text-se-muted">{c.passRate}%</span>
                                </div>
                            </div>
                        ))}
                    </div>
                    <div className="mt-4 p-3 bg-se-card/50 rounded-lg border border-se-border">
                        <p className="text-xs text-se-muted">Criteria are used to evaluate each conversation. Results appear in the AI Summary panel.</p>
                    </div>
                </div>
            );
        };

        // Criteria Drawer Component
        const CriteriaDrawer = ({ isOpen, criteria, onClose, onSave, onDelete }) => {
            const [formData, setFormData] = useState({ name: '', description: '', instructions: '' });
            const isEditing = criteria !== null;

            useEffect(() => {
                if (criteria) {
                    setFormData({ name: criteria.name, description: criteria.description, instructions: criteria.instructions || '' });
                } else {
                    setFormData({ name: '', description: '', instructions: '' });
                }
            }, [criteria, isOpen]);

            const handleSave = () => {
                if (formData.name && formData.description) {
                    onSave({ ...criteria, ...formData, id: criteria?.id || formData.name.toLowerCase().replace(/\s+/g, '_'), passRate: criteria?.passRate || 0, icon: criteria?.icon || 'Check' });
                }
            };

            if (!isOpen) return null;

            return (
                <>
                    <div className="fixed inset-0 bg-black/50 z-40" onClick={onClose} />
                    <div className="fixed right-0 top-0 h-full w-96 bg-se-darker border-l border-se-border z-50 shadow-2xl flex flex-col" style={{ animation: 'slideIn 0.2s ease-out' }}>
                        <div className="p-4 border-b border-se-border">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h2 className="text-lg font-semibold text-se-text">{isEditing ? 'Edit Criteria' : 'Create Criteria'}</h2>
                                    <p className="text-xs text-se-muted mt-1">{isEditing ? 'Modify evaluation criteria' : 'Define how conversations are evaluated'}</p>
                                </div>
                                <button onClick={onClose} className="p-1.5 hover:bg-se-hover rounded transition-colors text-se-muted">
                                    <Icons.X />
                                </button>
                            </div>
                        </div>
                        <div className="flex-1 p-4 overflow-y-auto space-y-4">
                            <div>
                                <label className="block text-xs font-medium text-se-muted mb-1.5">Criteria Name</label>
                                <input type="text" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    placeholder="e.g., Customer Satisfaction" className="w-full px-3 py-2 bg-se-card border border-se-border rounded-lg text-sm focus:outline-none focus:border-se-accent" />
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-se-muted mb-1.5">Description</label>
                                <textarea value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})}
                                    placeholder="Brief description of what this criteria measures..." rows={3}
                                    className="w-full px-3 py-2 bg-se-card border border-se-border rounded-lg text-sm focus:outline-none focus:border-se-accent resize-none" />
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-se-muted mb-1.5">Evaluation Instructions</label>
                                <textarea value={formData.instructions} onChange={(e) => setFormData({...formData, instructions: e.target.value})}
                                    placeholder="Detailed instructions for how the AI should evaluate this criteria..." rows={5}
                                    className="w-full px-3 py-2 bg-se-card border border-se-border rounded-lg text-sm focus:outline-none focus:border-se-accent resize-none" />
                                <p className="text-xs text-se-muted mt-1">This will be used as a prompt for evaluating conversations.</p>
                            </div>
                            <div className="p-3 bg-se-card/50 rounded-lg border border-se-border">
                                <p className="text-xs font-medium text-se-text mb-1">Tips for good criteria</p>
                                <ul className="text-xs text-se-muted space-y-0.5">
                                    <li>• Be specific about what constitutes success</li>
                                    <li>• Include examples of pass/fail scenarios</li>
                                    <li>• Focus on one measurable outcome</li>
                                </ul>
                            </div>
                            {isEditing && criteria.passRate > 0 && (
                                <div className="p-3 bg-se-card/50 rounded-lg border border-se-border">
                                    <p className="text-xs font-medium text-se-muted mb-2">Performance</p>
                                    <div className="flex items-center gap-2">
                                        <div className="flex-1 h-2 bg-se-border rounded-full overflow-hidden">
                                            <div className="h-full bg-se-accent rounded-full" style={{ width: `${criteria.passRate}%` }} />
                                        </div>
                                        <span className="text-sm font-semibold text-se-accent">{criteria.passRate}%</span>
                                    </div>
                                </div>
                            )}
                        </div>
                        <div className="p-4 border-t border-se-border space-y-2">
                            {isEditing && (
                                <button onClick={() => onDelete(criteria.id)} className="w-full px-3 py-2 bg-se-error/10 hover:bg-se-error/20 text-se-error rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2">
                                    <Icons.Trash /> Delete Criteria
                                </button>
                            )}
                            <div className="flex gap-2">
                                <button onClick={onClose} className="flex-1 px-3 py-2 bg-se-card hover:bg-se-hover rounded-lg text-sm font-medium transition-colors">Cancel</button>
                                <button onClick={handleSave} disabled={!formData.name || !formData.description}
                                    className="flex-1 px-3 py-2 bg-se-accent hover:bg-se-accent/80 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm font-medium transition-colors text-white">
                                    {isEditing ? 'Save Changes' : 'Create'}
                                </button>
                            </div>
                        </div>
                    </div>
                    <style>{'@keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }'}</style>
                </>
            );
        };

        // Main App
        const App = () => {
            const [conversations, setConversations] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [selectedId, setSelectedId] = useState(null);
            const [conversationFilter, setConversationFilter] = useState('all');
            const [search, setSearch] = useState('');
            const [useMockData, setUseMockData] = useState(!USE_LIVE_API);

            // Sidebar State
            const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
            const [criteriaPanelCollapsed, setCriteriaPanelCollapsed] = useState(false);

            // Evaluation Criteria State
            const [evaluationCriteria, setEvaluationCriteria] = useState(DEFAULT_CRITERIA);
            const [isDrawerOpen, setIsDrawerOpen] = useState(false);
            const [editingCriteria, setEditingCriteria] = useState(null);

            const openCreateDrawer = () => { setEditingCriteria(null); setIsDrawerOpen(true); };
            const openEditDrawer = (criteria) => { setEditingCriteria(criteria); setIsDrawerOpen(true); };
            const closeDrawer = () => { setIsDrawerOpen(false); setEditingCriteria(null); };

            const saveCriteria = (criteriaData) => {
                if (editingCriteria) {
                    setEvaluationCriteria(evaluationCriteria.map(c => c.id === criteriaData.id ? criteriaData : c));
                } else {
                    setEvaluationCriteria([...evaluationCriteria, criteriaData]);
                }
                closeDrawer();
            };

            const deleteCriteria = (id) => {
                setEvaluationCriteria(evaluationCriteria.filter(c => c.id !== id));
                closeDrawer();
            };

            // Fetch conversations from API
            const fetchConversations = async () => {
                if (useMockData) {
                    setConversations(MOCK_CONVERSATIONS);
                    setLoading(false);
                    return;
                }

                setLoading(true);
                setError(null);

                try {
                    const response = await fetch(`${API_BASE}/conversations`);
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    const data = await response.json();

                    // ElevenLabs returns { conversations: [...] }
                    const convList = data.conversations || data || [];

                    if (convList.length === 0) {
                        // No live conversations, fall back to mock
                        console.log('No live conversations found, using mock data');
                        setConversations(MOCK_CONVERSATIONS);
                        setUseMockData(true);
                        setLoading(false);
                        return;
                    }

                    // Transform basic list first
                    const basicConvs = convList.map(c => transformConversation(c));
                    setConversations(basicConvs);

                    // Fetch full details for each conversation
                    const detailedConvs = await Promise.all(
                        convList.slice(0, 20).map(async (conv) => {
                            try {
                                const detailRes = await fetch(`${API_BASE}/conversations/${conv.conversation_id}`);
                                if (detailRes.ok) {
                                    const details = await detailRes.json();
                                    return transformConversation(conv, details);
                                }
                            } catch (e) {
                                console.warn(`Failed to fetch details for ${conv.conversation_id}:`, e);
                            }
                            return transformConversation(conv);
                        })
                    );

                    setConversations(detailedConvs);
                } catch (err) {
                    console.error('Failed to fetch conversations:', err);
                    setError(err.message);
                    // Fall back to mock data on error
                    setConversations(MOCK_CONVERSATIONS);
                    setUseMockData(true);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchConversations();
            }, [useMockData]);

            const selectedConversation = useMemo(() =>
                conversations.find(c => c.id === selectedId),
                [conversations, selectedId]
            );

            const toggleDataSource = () => {
                setUseMockData(!useMockData);
            };

            const isEvaluateMode = conversationFilter === 'evaluate';

            return (
                <div className="h-screen flex">
                    <NavSidebar
                        conversationFilter={conversationFilter}
                        setConversationFilter={setConversationFilter}
                        isCollapsed={sidebarCollapsed}
                        onToggleCollapse={() => setSidebarCollapsed(!sidebarCollapsed)}
                    />
                    {isEvaluateMode ? (
                        <>
                            <EvaluateTableView
                                conversations={conversations}
                                selectedId={selectedId}
                                onSelect={setSelectedId}
                                search={search}
                                setSearch={setSearch}
                            />
                            {selectedConversation && (
                                <ConversationDetail conversation={selectedConversation} evaluationCriteria={evaluationCriteria} />
                            )}
                            <EvaluationCriteriaPanel
                                criteria={evaluationCriteria}
                                onAdd={openCreateDrawer}
                                onEdit={openEditDrawer}
                                isCollapsed={criteriaPanelCollapsed}
                                onToggleCollapse={() => setCriteriaPanelCollapsed(!criteriaPanelCollapsed)}
                            />
                        </>
                    ) : (
                        <>
                            <ConversationList
                                conversations={conversations}
                                selectedId={selectedId}
                                onSelect={setSelectedId}
                                filter={conversationFilter}
                                search={search}
                                setSearch={setSearch}
                                loading={loading}
                                error={error}
                                onRefresh={fetchConversations}
                                useMockData={useMockData}
                                onToggleDataSource={toggleDataSource}
                            />
                            <ConversationDetail conversation={selectedConversation} evaluationCriteria={null} />
                        </>
                    )}
                    <CriteriaDrawer
                        isOpen={isDrawerOpen}
                        criteria={editingCriteria}
                        onClose={closeDrawer}
                        onSave={saveCriteria}
                        onDelete={deleteCriteria}
                    />
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
